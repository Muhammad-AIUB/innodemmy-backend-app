generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////////////////////////////////////
// ENUMS
//////////////////////////////////////////////////

enum UserRole {
  STUDENT
  ADMIN
  SUPER_ADMIN
}

enum AuthProvider {
  EMAIL
  GOOGLE
}

enum WebinarStatus {
  DRAFT
  PUBLISHED
}

enum BlogStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum CourseStatus {
  DRAFT
  PUBLISHED
}

enum EnrollmentStatus {
  PENDING
  ACTIVE
  CANCELLED
}

enum LessonType {
  VIDEO
  QUIZ
  ASSIGNMENT
}

//////////////////////////////////////////////////
// USER + AUTH
//////////////////////////////////////////////////

model User {
  id            String   @id @default(uuid())
  name          String?
  email         String   @unique
  password      String?
  phoneNumber   String?

  role          UserRole @default(STUDENT)
  provider      AuthProvider @default(EMAIL)
  googleId      String?  @unique

  isVerified    Boolean  @default(false)
  isActive      Boolean  @default(true)
  isDeleted     Boolean  @default(false)

  createdById   String?
  createdBy     User?    @relation("AdminCreator", fields: [createdById], references: [id])
  createdAdmins User[]   @relation("AdminCreator")

  createdCourses Course[]
  adminEnrollments Enrollment[] @relation("AdminEnrollment")

  enrollments   Enrollment[]
  submissions   AssignmentSubmission[]
  otpCodes      OtpCode[]
  notifications Notification[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model OtpCode {
  id        String   @id @default(uuid())
  email     String
  code      String
  expiresAt DateTime
  isUsed    Boolean  @default(false)

  userId    String?
  user      User?    @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
}

model PasswordResetToken {
  id        String   @id @default(uuid())
  email     String
  token     String   @unique
  expiresAt DateTime
  isUsed    Boolean  @default(false)

  createdAt DateTime @default(now())
}

//////////////////////////////////////////////////
// WEBINAR
//////////////////////////////////////////////////

model Webinar {
  id               String        @id @default(uuid())
  title            String
  slug             String        @unique
  description      String
  date             DateTime
  duration         Int
  sectionOneTitle  String?
  sectionOnePoints String[]      @default([])
  sectionTwoTitle  String?
  sectionTwoPoints String[]      @default([])
  status           WebinarStatus @default(DRAFT)
  isDeleted        Boolean       @default(false)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
}

//////////////////////////////////////////////////
// BLOG
//////////////////////////////////////////////////

model Blog {
  id              String      @id @default(uuid())
  title           String
  slug            String      @unique
  excerpt         String?
  content         Json
  bannerImage     String?
  readDuration    Int?
  publishedAt     DateTime?
  status          BlogStatus  @default(DRAFT)
  isDeleted       Boolean     @default(false)

  authorId        String
  author          Author      @relation(fields: [authorId], references: [id])

  categoryId      String?
  category        Category?   @relation(fields: [categoryId], references: [id])

  tags            BlogTag[]

  seoTitle        String?
  seoDescription  String?
  seoKeywords     String[]

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  @@index([status])
}

model Author {
  id        String   @id @default(uuid())
  name      String
  bio       String?
  avatar    String?
  blogs     Blog[]
}

model Category {
  id        String   @id @default(uuid())
  name      String
  slug      String   @unique
  blogs     Blog[]
}

model Tag {
  id        String   @id @default(uuid())
  name      String   @unique
  blogs     BlogTag[]
}

model BlogTag {
  blogId String
  tagId  String

  blog   Blog @relation(fields: [blogId], references: [id])
  tag    Tag  @relation(fields: [tagId], references: [id])

  @@id([blogId, tagId])
}

//////////////////////////////////////////////////
// COURSE
//////////////////////////////////////////////////

model Course {
  id            String   @id @default(uuid())
  title         String
  slug          String   @unique
  description   String
  bannerImage   String
  price         Float
  discountPrice Float?
  duration      Int
  startDate     DateTime
  classDays     String
  classTime     String
  totalModules  Int
  totalProjects Int
  totalLive     Int

  status        CourseStatus @default(DRAFT)
  isDeleted     Boolean      @default(false)

  createdById   String
  createdBy     User         @relation(fields: [createdById], references: [id])

  modules       CourseModule[]
  instructors   CourseInstructor[]
  enrollments   Enrollment[]
  faqs          FAQ[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model CourseModule {
  id        String @id @default(uuid())
  title     String
  courseId  String
  course    Course @relation(fields: [courseId], references: [id])

  lessons   Lesson[]
}

model Lesson {
  id        String     @id @default(uuid())
  title     String
  type      LessonType
  videoUrl  String?
  moduleId  String
  module    CourseModule @relation(fields: [moduleId], references: [id])

  quiz      Quiz?
  assignment Assignment?
}

model Quiz {
  id       String  @id @default(uuid())
  lessonId String  @unique
  lesson   Lesson  @relation(fields: [lessonId], references: [id])

  title    String
}

model Assignment {
  id       String  @id @default(uuid())
  lessonId String  @unique
  lesson   Lesson  @relation(fields: [lessonId], references: [id])

  title    String
  description String

  submissions AssignmentSubmission[]
}

model AssignmentSubmission {
  id           String @id @default(uuid())
  assignmentId String
  userId       String
  fileUrl      String

  assignment Assignment @relation(fields: [assignmentId], references: [id])
  user       User       @relation(fields: [userId], references: [id])

  createdAt  DateTime @default(now())

  @@unique([assignmentId, userId])
}

model Instructor {
  id        String   @id @default(uuid())
  name      String
  image     String?
  bio       String?

  courses   CourseInstructor[]
}

model CourseInstructor {
  courseId     String
  instructorId String

  course       Course     @relation(fields: [courseId], references: [id])
  instructor   Instructor @relation(fields: [instructorId], references: [id])

  @@id([courseId, instructorId])
}

model FAQ {
  id       String @id @default(uuid())
  question String
  answer   String
  courseId String
  course   Course @relation(fields: [courseId], references: [id])
}

model Enrollment {
  id        String @id @default(uuid())
  userId    String
  courseId  String
  status    EnrollmentStatus @default(PENDING)

  enrolledById String?
  enrolledBy   User? @relation("AdminEnrollment", fields: [enrolledById], references: [id])

  user      User   @relation(fields: [userId], references: [id])
  course    Course @relation(fields: [courseId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, courseId])
}

//////////////////////////////////////////////////
// NOTIFICATION
//////////////////////////////////////////////////

model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id])

  @@index([userId])
}