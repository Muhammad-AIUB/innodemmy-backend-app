//Webinar//

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum WebinarStatus {
  DRAFT
  PUBLISHED
}

model Webinar {
  id               String        @id @default(uuid())
  title            String
  slug             String        @unique
  description      String
  date             DateTime
  duration         Int
  sectionOneTitle  String?
  sectionOnePoints String[]      @default([])
  sectionTwoTitle  String?
  sectionTwoPoints String[]      @default([])
  status           WebinarStatus @default(DRAFT)
  isDeleted        Boolean       @default(false)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
}

//Blog//

enum BlogStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model Blog {
  id              String      @id @default(uuid())
  title           String
  slug            String      @unique
  excerpt         String?
  content         Json        // TipTap JSON
  bannerImage     String?
  readDuration    Int?
  publishedAt     DateTime?
  status          BlogStatus  @default(DRAFT)
  isDeleted       Boolean     @default(false)

  authorId        String
  author          Author      @relation(fields: [authorId], references: [id])

  categoryId      String?
  category        Category?   @relation(fields: [categoryId], references: [id])

  tags            BlogTag[]

  seoTitle        String?
  seoDescription  String?
  seoKeywords     String[]

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  @@index([status])
  @@index([publishedAt])
  @@index([categoryId])
}

model Author {
  id        String   @id @default(uuid())
  name      String
  bio       String?
  avatar    String?
  blogs     Blog[]
  createdAt DateTime @default(now())
}

model Category {
  id        String   @id @default(uuid())
  name      String
  slug      String   @unique
  blogs     Blog[]
  createdAt DateTime @default(now())
}

model Tag {
  id        String   @id @default(uuid())
  name      String   @unique
  blogs     BlogTag[]
}

model BlogTag {
  blogId String
  tagId  String

  blog   Blog @relation(fields: [blogId], references: [id])
  tag    Tag  @relation(fields: [tagId], references: [id])

  @@id([blogId, tagId])
}

// ==============================
// ENUMS
// ==============================

enum CourseStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum EnrollmentStatus {
  PENDING
  ACTIVE
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  UNPAID
  PAID
  FAILED
  REFUNDED
}


// ==============================
// COURSE CORE
// ==============================

model Course {
  id                String   @id @default(uuid())
  title             String
  slug              String   @unique
  shortDescription  String
  description       Json      // Rich text (TipTap JSON)
  bannerImage       String
  promoVideoUrl     String?

  price             Int
  discountPrice     Int?
  currency          String    @default("BDT")

  batchNumber       Int?
  startDate         DateTime?
  classDays         String?
  classTime         String?
  durationInMonths  Int?

  status            CourseStatus @default(DRAFT)
  isFeatured        Boolean @default(false)

  modules           CourseModule[]
  benefits          CourseBenefit[]
  targetAudiences   CourseAudience[]
  requirements      CourseRequirement[]
  faqs              CourseFAQ[]
  instructors       CourseInstructor[]

  enrollments       Enrollment[]
  consultations     ConsultationRequest[]

  seo               CourseSEO?

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([status])
  @@index([slug])
  @@index([isFeatured])
}



// ==============================
// COURSE MODULE
// ==============================

model CourseModule {
  id          String @id @default(uuid())
  courseId    String
  title       String
  description String
  tierLabel   String?
  order       Int

  liveClasses Int?
  projects    Int?

  course      Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([order])
}



// ==============================
// WHAT YOU WILL GET
// ==============================

model CourseBenefit {
  id          String @id @default(uuid())
  courseId    String
  title       String
  description String
  icon        String?
  order       Int

  course      Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([order])
}



// ==============================
// TARGET AUDIENCE
// ==============================

model CourseAudience {
  id          String @id @default(uuid())
  courseId    String
  description String
  icon        String?
  order       Int

  course      Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([order])
}



// ==============================
// REQUIREMENTS
// ==============================

model CourseRequirement {
  id          String @id @default(uuid())
  courseId    String
  description String
  order       Int

  course      Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([order])
}



// ==============================
// FAQ
// ==============================

model CourseFAQ {
  id        String @id @default(uuid())
  courseId  String
  question  String
  answer    String
  order     Int

  course    Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([order])
}



// ==============================
// INSTRUCTOR (Reusable)
// ==============================

model Instructor {
  id        String @id @default(uuid())
  name      String
  bio       String
  avatar    String?

  courses   CourseInstructor[]
}



// ==============================
// COURSE ↔ INSTRUCTOR RELATION
// ==============================

model CourseInstructor {
  id           String @id @default(uuid())
  courseId     String
  instructorId String

  course       Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
  instructor   Instructor @relation(fields: [instructorId], references: [id], onDelete: Cascade)

  @@unique([courseId, instructorId])
  @@index([courseId])
  @@index([instructorId])
}



// ==============================
// ENROLLMENT (User ↔ Course)
// ==============================

model Enrollment {
  id            String @id @default(uuid())
  courseId      String
  userId        String

  status        EnrollmentStatus @default(PENDING)
  paymentStatus PaymentStatus @default(UNPAID)

  enrolledAt    DateTime @default(now())

  course        Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user          User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([courseId, userId])
  @@index([userId])
  @@index([courseId])
}



// ==============================
// CONSULTATION FORM
// ==============================

model ConsultationRequest {
  id        String   @id @default(uuid())
  courseId  String?
  fullName  String
  email     String
  phone     String
  message   String?

  createdAt DateTime @default(now())

  course    Course? @relation(fields: [courseId], references: [id], onDelete: SetNull)

  @@index([email])
  @@index([courseId])
}



// ==============================
// SEO
// ==============================

model CourseSEO {
  id              String   @id @default(uuid())
  courseId        String   @unique
  metaTitle       String
  metaDescription String
  keywords        String[]

  course          Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
}